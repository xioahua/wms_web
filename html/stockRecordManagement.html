<!-- 出入库记录 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/bootstrap-table.css">
    <link rel="stylesheet" href="../css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../css/mainPage.css">
    <!-- 提示框 -->
	<link rel="stylesheet" href="../css/toastr.min.css">
</head>
<!-- 引入vue -->
<script src="../js/vue.js"></script>
<script src="../js/axios.min.js"></script>
<script type="text/javascript" src="../js/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="../js/bootstrap.min.js"></script>
<!-- 提示框 -->
<script src="../js/toastr.min.js"></script>
<script type="text/javascript">		// js初始化
    toastr.options.positionClass = 'toast-top-center';
</script>

<body>
<div id="app">
    <div class="panel panel-default">
        <ol class="breadcrumb">
            <li>出入库记录</li>
        </ol>
        <div class="panel-body">
            <div class="row" style="margin-left: 10px;">
                <form class="form-inline">
                    <div class="form-group">
                        <label class="form-label">仓库名：</label>
                        <select class="form-control" v-model="storeNameSelected" @change="change_store_name($event)">
                            <option value="">所有仓库</option>
                            <option v-for="value,key in storeList" v-text="value" :value="key"></option>
                        </select>
                    </div>
                </form>
                <form class="form-inline" style="margin-left: 10px;">
                    <label class="form-label">记录过滤：</label>
                    <select class="form-control" v-model="in_or_out" @change="change_in_out($event)">
                        <option value="">显示所有</option>
                        <option value="IN">仅显示入库记录</option>
                        <option value="OUT">仅显示出库记录</option>
                    </select>
                </form>
                <!-- <form action="" class="form-inline"  style="margin-left: 10px;">
                    <label class="form-label">日期范围：</label>
                    <input class="form_date form-control" value="" id="search_start_date" name="" placeholder="开始日期">
                    <label class="form-label">&nbsp;&nbsp;-&nbsp;&nbsp;</label>
                    <input class="form_date form-control" value="" id="search_end_date" name="" placeholder="结束日期">
                </form> -->
                <button class="btn btn-success" style="margin-left: 10px;" @click="queryInOurOutRecord()">
                    <span class="glyphicon glyphicon-search"></span><span>查询</span>
                </button>
            </div>

            <div class="row" style="margin-top: 25px">
                <div class="col-md-5">
                    <button class="btn btn-sm btn-default" data-toggle="modal" data-target="#add_modal">
                        <span class="glyphicon glyphicon-plus"></span><span>添加出入库记录</span>
                    </button>
                    <button class="btn btn-sm btn-default" data-toggle="modal" data-target="#import_modal">
                        <span class="glyphicon glyphicon-import"></span> <span>明细导入</span>
                    </button>
                    <button class="btn btn-sm btn-default"  data-toggle="modal" data-target="#export_modal">
                        <span class="glyphicon glyphicon-export"></span> <span>明细导出</span>
                    </button>
                </div>
            </div>

            <div class="row" style="margin-top:25px">
                <div class="col-sm-12">
                    <table id="stockRecords" class="table table-striped table-bordered table-hover">
                        <tr>
                            <th>选择</th>
                            <th>记录ID</th>
                            <th>出入库编号</th>
                            <th>出入库类型</th>
                            <th>所属仓库</th>
                            <th>供应商</th>
                            <th>用途</th>
                            <th>领料部门</th>
                            <th>记录状态</th>
                            <th>备注</th>
                            <th>操作</th>
                        </tr>
                        <tbody>
                            <tr v-for="item in queryInOurOutRecordList">
                                <td><input type="radio" name="InOurOutRecord" :value="item.inOutNumber" v-model="selectedInOutNumber"></td>
                                <td v-text="item.id"></td>
                                <td v-text="item.inOutNumber"></td>
                                <td v-text="item.warehousingType"></td>
                                <td v-text="item.warehousingBelongStore"></td>
                                <td v-text="item.supplerId"></td>
                                <td v-text="item.functionUse"></td>
                                <td v-text="item.receiveDepartment"></td>
                                <td v-text="item.recordStatus"></td>
                                <td v-text="item.remark"></td>
                                <td>
                                    <!-- <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#xiang_qing_modal" @click="row_xiang_qing(item.id)">详情</button>  删除 -->
                                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#edit_modal" @click="edit_row(item.id)">编辑</button>
                                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#xiang_qing_modal" @click="row_mingxi(item.inOutNumber)">明细</button>
                                    <button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteWarning_modal" @click="row_delete(item.id)">删除</button>
                                </td>
                            </tr>
                            <tr v-if="page_data.total==0"><td colspan="14">未查到数据</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- 底部分页 -->
                <div class="row" v-show="page_data.pages>0">
                    <div class="col-sm-5 col-sm-offset-5">
                        <ul class="pagination">
                            <li><span v-bind:class="pageIndex==1?'btn disabled':'btn'"  @click="searchPrevious()" data-toggle="modal">&laquo;</span></li>
                            <li v-bind:class="pageIndex==page?'active':''" v-for="page in page_data.pages">
                                <span v-text="page" class="btn" @click="searchPageIndex(page)" data-toggle="modal"></span>
                            </li>
                            <li><span v-bind:class="pageIndex >= page_data.pages?'btn disabled':'btn'"  @click="searchNext()" data-toggle="modal">&raquo;</span></li>
                        </ul>
                    </div>
                </div>
        </div>
    </div>

    <!-- 添加出入库记录模态框 -->
    <div id="add_modal" class="modal fade" table-index="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">添加出入库记录</h4>
                </div>
                <div class="modal-body">
                    <!-- 模态框的内容 -->
                    <div class="row">
                        <div class="col-md-1 col-sm-1"></div>
                        <div class="col-md-8 col-sm-8">
                            <form class="form-horizontal" role="form" id="repository_form"
                                style="margin-top: 25px">
                                <div class="form-group">
                                    <label for="" class="control-label col-md-4 col-sm-4"> <span>出入库类型：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="in_or_out_modal" @change="change_in_out_modal($event)">
                                            <option value="">请选择出入库类型</option>
                                            <option value="IN">入库</option>
                                            <option value="OUT">出库</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="control-label col-md-4 col-sm-4"> <span>所属仓库：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="belongStroe" @change="changebelongStore($event)">
                                            <option value="">请选择所属仓库</option>
                                            <option v-for="(value,key) in storeList" :value="key" v-text="value"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="control-label col-md-4 col-sm-4"> <span>用途：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <input type="text" class="form-control" v-model="yongtu_addmodal" />
                                    </div>
                                </div>
                                <div class="form-group" v-show="isShowlingliaobumen">
                                    <label for="" class="control-label col-md-4 col-sm-4"> <span>领料部门：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <div class="dropdown">
                                            <select class="form-control" v-model="lingliaobumen_addModal" @change="change_lingliaobumen($event)">
                                                <option value="">请选择领料部门</option>
                                                <option value="bumen01">部门1</option>
                                                <option value="bumen02">部门2</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group" v-show="isShowSupplier">
                                    <label for="" class="control-label col-md-4 col-sm-4"> <span>供应商：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <div class="dropdown">
                                            <select class="form-control" v-model="supplierSelected" @change="change_supplier($event)">
                                                <option value="">请选择供应商</option>
                                                <option value="supplier01">供应商01</option>
                                                <option value="supplier02">供应商02</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="control-label col-md-4 col-sm-4"><span>备注：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <textarea class="form-control" placeholder="备注" v-model="remark_addModal" style="min-width: 100%"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" data-dismiss="modal">
                        <span>取消</span>
                    </button>
                    <button class="btn btn-success" type="button" @click="add_in_out_record_modal()">
                        <span>提交</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导入出入库记录模态框 -->
    <div class="modal fade" id="import_modal" table-index="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" 
        data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">导入出入库记录明细</h4>
                </div>
                <div class="modal-body">
                    <div id="step1" v-show="show_step1" :style="{display:(stepNumNow==1?'block':'none')}">
                        <div class="row" style="margin-top: 15px">
                            <div class="col-md-1 col-sm-1"></div>
                            <div class="col-md-10 col-sm-10">
                                <div>
                                    <h4>第一步：选择出入库编号后点击下面的下载按钮，下载导入电子表格模板</h4>
                                </div>
                                <div style="margin-top: 30px; margin-bottom: 15px">
                                    <a class="btn btn-info" :href="'http://localhost:8080/SMS/commons/fileSource/downInOrOutDetail?token=' + this.token"
                                        target="_blank"> <span class="glyphicon glyphicon-download"></span>
                                        <span>下载</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="step2" v-show="show_step2" :style="{display:(stepNumNow==2?'block':'none')}">
                        <div class="row" style="margin-top: 15px">
                            <div class="col-md-1 col-sm-1"></div>
                            <div class="col-md-10 col-sm-10">
                                <div>
                                    <h4>第二步：请按照仓库信息电子表格中指定的格式填写需要添加的一个或多个记录信息</h4>
                                </div>
                                <div class="alert alert-info"
                                    style="margin-top: 10px; margin-bottom: 30px">
                                    <p>注意：表格中各个列均不能为空，若存在未填写的项，则该条信息将不能成功导入</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="step3" v-show="show_step3" :style="{display:(stepNumNow==3?'block':'none')}">
                        <div class="row" style="margin-top: 15px">
                            <div class="col-md-1 col-sm-1"></div>
                            <div class="col-md-10 col-sm-10">
                                <div>
                                    <div>
                                        <h4>第三步：请点击下面上传文件按钮，上传填写好的客户信息电子表格</h4>
                                    </div>
                                    <div style="margin-top: 30px; margin-bottom: 15px">
                                        <span class="btn btn-info btn-file">
                                            <span class="glyphicon glyphicon-upload"></span>
                                            <span>上传文件</span>
                                            <form id="import_file_upload">
                                                <input type="file" @change="getFile($event)">
                                            </form>
                                        </span>
                                        <span v-text="fileName" style="position: relative;top: 10px;"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn ben-default" type="button" @click="previous()" v-show="stepNumNow>1">
                        <span>上一步</span>
                    </button>
                    <button class="btn btn-success" type="button" @click="next()" v-show="stepNumNow<3">
                        <span>下一步</span>
                    </button>
                    <button class="btn btn-success" type="button" v-show="stepNumNow==3" @click="submitImport($event)">
                        <span>提交导入</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 导出出入库记录模态框 -->
    <div class="modal fade" id="export_modal" table-index="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">导出出入库记录明细</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-3" style="text-align: center;">
                            <img src="../media/icons/warning-icon.png" alt=""
                                style="width: 70px; height: 70px; margin-top: 20px;">
                        </div>
                        <div class="col-md-8 col-sm-8">
                            <h3>是否确认导出所选记录的出入库明细</h3>
                            <p>(注意：请确定要导出的出入库记录，导出的内容为当前列表的搜索结果)</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" data-dismiss="modal">
                        <span>取消</span>
                    </button>
                    <a class="btn btn-success" type="button" target="_blank" @click="confimExport()">
                        <span>确认导出</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除提示模态框 -->
    <div class="modal fade" id="deleteWarning_modal" table-index="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">警告</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-3" style="text-align: center;">
                            <img src="../media/icons/warning-icon.png" alt=""
                                style="width: 70px; height: 70px; margin-top: 20px;">
                        </div>
                        <div class="col-md-8 col-sm-8">
                            <h3>是否确认删除该条仓库信息</h3>
                            <p>(注意：若该仓库已经有出入库记录或仓存信息，则该仓库信息将不能删除成功。如需删除该仓库的信息，请保证该仓库没有出入库和仓存信息关联)</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" data-dismiss="modal">
                        <span>取消</span>
                    </button>
                    <button class="btn btn-danger" type="button" @click="delete_in_out_ofconfirmModal()">
                        <span>确认删除</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑出入库记录模态框 -->
    <div id="edit_modal" class="modal fade" table-index="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">编辑出入库记录</h4>
                </div>
                <div class="modal-body">
                    <!-- 模态框的内容 -->
                    <div class="row">
                        <div class="col-md-10 col-sm-10">
                            <form class="form-horizontal" role="form" id="repository_form_edit" style="margin-top: 25px">
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"><span>记录ID：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <input type="text" class="form-control" readonly :value="edit_id">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"> <span>出入库编号：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <input type="text" class="form-control" readonly :value="edit_inOutNumber">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"><span>出入库类型：</span></label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="edit_in_out_type" @change="change_edit_in_out_type($event)">
                                            <option value="IN">入库</option>
                                            <option value="OUT">出库</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"> <span>所属仓库：</span></label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="edit_belongStore" @change="change_edit_belongStore($event)">
                                            <option v-for="(value,key) in storeList" :value="key" v-text="value"></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group" v-show="edit_in_out_type == 'IN'">
                                    <label class="control-label col-md-4 col-sm-4"><span>供应商：</span></label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="edit_supllier" @change="change_edit_supllier($event)">
                                            <option value="1001">供应商1</option>
                                            <option value="1003">供应商2</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group" v-show="edit_in_out_type == 'OUT'">
                                    <label class="control-label col-md-4 col-sm-4"> <span>领料部门：</span></label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" v-model="edit_receiveDepartment" @change="change_edit_receiveDepartment($event)">
                                            <option value="part1">部门1</option>
                                            <option value="part2">部门2</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"> <span>用途：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <input type="text" class="form-control" placeholder="用途" v-model="edit_functionUse">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4 col-sm-4"> <span>备注：</span>
                                    </label>
                                    <div class="col-md-8 col-sm-8">
                                        <textarea class="form-control" placeholder="备注" v-model="edit_remark"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" type="button" data-dismiss="modal">
                        <span>取消</span>
                    </button>
                    <button class="btn btn-success" type="button" @click="confirm_update()">
                        <span>确认更改</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 明细模态框 -->
    <div id="xiang_qing_modal" class="modal fade" table-index="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog" style="width: 1300px;height:630px;overflow:auto; ">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" type="button" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">出入库记录明细</h4>
                </div>
                <div class="modal-body">
                    <div class="row" style="margin-top:25px">
                        <div class="col-sm-12">
                            <table class="table table-striped table-bordered table-hover">
                                <tr>
                                    <th>明细ID</th>
                                    <th>出入库编号</th>
                                    <th>物资名称</th>
                                    <th>物资类型</th>
                                    <th>物资单位</th>
                                    <th>所需数量</th>
                                    <th>实际出入库数量</th>
                                    <th>物资规格</th>
                                    <th>记录状态</th>
                                    <th>所属仓库</th>
                                    <th>物资价值</th>
                                    <th>备注</th>
                                    <th>明细创建人</th>
                                    <th>明细创建时间</th>
                                </tr>
                                <tbody>
                                    <tr v-for="item in recored_result.list">
                                        <td v-text="item.detailId"></td>
                                        <td v-text="item.inOutNumber"></td>
                                        <td v-text="item.goodName"></td>
                                        <td v-text="item.goodType"></td>
                                        <td v-text="item.goodUnits"></td>
                                        <td v-text="item.goodNeedNum"></td>
                                        <td v-text="item.goodActualNum"></td>
                                        <td v-text="item.goodSize"></td>
                                        <td v-text="item.status"></td>
                                        <td v-text="item.goodStoreName"></td>
                                        <td v-text="item.goodValue"></td>
                                        <td v-text="item.remark"></td>
                                        <td v-text="item.createdBy"></td>
                                        <td v-text="item.createdAt"></td>
                                    </tr>
                                    <tr v-if="recored_result.total==0"><td colspan="14">该记录暂无明细数据</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="button" data-dismiss="modal">
                        <span>关闭</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	const app = new Vue({
        el:"#app",
        data:{
            token:"",
            queryInOurOutRecordList:[],
            storeList:[],       // 仓库名下拉选项

            in_or_out:"",  
            storeNameSelected:"",

            show_step1:true,       //模态框隐藏显示类属性
            show_step2:false,
            show_step3:false,
            stepNumNow: 1,

            //导入相关变量
            file:"",
            fileName: "",
            selectedInOutNumber:"",

            // 修改相关变量
            belongStroe: "",
            in_or_out_modal:"",

            // 切换供应商和领料部门显示
            isShowSupplier: false,
            isShowlingliaobumen: false,

            //添加出入库记录模态框
            yongtu_addmodal:"",
            remark_addModal:"",
            supplierSelected: "",
            lingliaobumen_addModal:"",

            //出入库记录明细变量
            recored_result:[],
            //删除出入库记录变量
            delete_in_out_record_id:"",
            //出入库记录行编辑
            edit_row_of_id:[],
            //编辑出入库记录模态框
            edit_id:"",
            edit_inOutNumber:"",
            edit_in_out_type:"",
            edit_belongStore:"",
            edit_supllier:"",
            edit_functionUse:"",
            edit_receiveDepartment:"",
            edit_remark:"",
            // 分页参数
            pageIndex:1,
            pageSize:10,
            page_data:[],		//包含总页数，当前页数，页面显示条数等
        },
        methods: {
            // 模态框上一步
            previous(){
                if (this.stepNumNow > 1) {
                    this.stepNumNow--;
                    switch(this.stepNumNow){
                        case 1: {}
                        case 2: {this.show_step1 = false; this.show_step2 = true;break;}
                        case 3: {this.show_step2 = false; this.show_step3 = true;break;}
                    }
                    console.log(this.stepNumNow);
                }
            },
            next(){
                if(this.selectedInOutNumber != ""){
                    if (this.stepNumNow < 3) {
                        this.stepNumNow++;
                        switch(this.stepNumNow){
                            case 1: {break}
                            case 2: {this.show_step1 = false; this.show_step2 = true;break}
                            case 3: {this.show_step2 = false; this.show_step3 = true;break}
                        }
                        console.log(this.stepNumNow);
                    }
                }else{
                    toastr.error("请选择将此文件导入到哪个记录编号里！");
                }
            },
            queryInOurOutRecord(){      // 查询出入库列表
                axios.post("http://localhost:8080/SMS/store/queryInOurOutRecordList", 
                {operateNo:"1001", traceLogId:"111111",warehousingBelongStore:this.storeNameSelected, warehousingType: this.in_or_out,
                pageSize:this.pageSize,pageIndex:this.pageIndex,traceLogId:"11111111"},{headers: {'token': this.token}}).then(res =>{
                    console.log(res)
                    this.queryInOurOutRecordList = res.data.result.list;
                    this.page_data = res.data.result;
                })
            },
            getStoreEnum(){		//获取下拉枚举值
                const _this = this
                axios.post("http://localhost:8080/SMS/enums/storeEnum",{operateNo:"1001", traceLogId:"111111"},{headers: {'token': this.token}}).then(function(res){
                    console.log(res)
                    _this.storeList = res.data.result.storeMap;
                });
            },
            change_in_out(event){       // 下拉选择出入库明细
                this.in_or_out = event.target.value;
                console.log(this.in_or_out)
            },
            change_store_name(event){       //选择仓库名
                this.storeNameSelected = event.target.value;
                console.log(this.storeNameSelected)
            },
            submitImport(event){        //提交导入,如果提交成功，则隐藏模态框，否则提示错误信息。
                event.preventDefault();
                let param = new FormData();     //创建form对象
                param.append('file',this.file);          //通过append向form对象添加数据
                param.append('operateNo',"1001");               //通过append向form对象添加数据
                param.append('inOutNumber',this.selectedInOutNumber);          //通过append向form对象添加数据
                let config = {      //添加请求头
                    headers:{'Content-Type':'multipart/form-data','token': this.token}
                };
                if (this.file!="") {    //检查是否选择上传文件
                    axios.post('http://localhost:8080/SMS/store/importStoreIn',param,config).then(response=>{
                        console.log(response.data)
                        if(response.data.success == true){
                            $('.modal').map(function () {
                                if (!$(this).is(":hidden")){
                                    $(this).modal('hide');
                                    this.stepNumNow = 1
                                }
                            });
                            this.file = '';
                            this.fileName = '';
                            toastr.success("已解析"+response.data.result.avaliableNum+"条,导入成功"+ response.data.result.totalNum+"条");
                            this.queryInOurOutRecord();
                        }else{
                            toastr.error(response.data.errorMsg);
                        }
                    })
                } else {
                    toastr.error("请选择上传文件");
                }
            },
            getFile(event){       //上传文件按钮
                this.file = event.target.files[0];
                console.log(this.file)
                this.fileName = this.file.name;
            },
            confimExport(){   // 导出模态框确认下载
                if (this.queryInOurOutRecordList.length != 0){
                    if(this.selectedInOutNumber != ""){
                        axios.post("http://localhost:8080/SMS/commons/fileSource/exportStoreIn",
                            {inOutNumber:this.selectedInOutNumber,operateNo:"1001"},{headers: {'token': this.token},responseType:'blob'}).then(res =>{
                            // console.log(res);
                            const a = document.createElement('a');
                            document.body.appendChild(a);
                            a.href = window.URL.createObjectURL(res.data);
                            a.download = this.selectedInOutNumber + '出入库记录明细导出.xls';
                            a.click();
                            window.URL.revokeObjectURL(res.data);
                        })
                        $('.modal').map(function () {
                            if (!$(this).is(":hidden")){
                                $(this).modal('hide');
                                this.stepNumNow = 1
                            }
                        }); 
                    }else{
                        toastr.error("请选择所导出明细的记录编号！");
                    }
                } else {
                    toastr.error("查询出入库记录为空，无需导出！");
                }
            },
            edit_row(id){   //编辑行
                axios.post("http://localhost:8080/SMS/store/queryInOurOutRecordDetail",{id:id, operateNo:"1001",traceLogId:"11111"},{headers: {'token': this.token}}).then(res=>{
                    console.log(res);
                    this.edit_id=id;
                    this.edit_inOutNumber = res.data.result.inOutNumber;
                    this.edit_in_out_type = res.data.result.warehousingType;
                    this.edit_belongStore = res.data.result.warehousingBelongStore;
                    this.edit_supllier = res.data.result.supplerId;
                    this.edit_functionUse = res.data.result.functionUse;
                    this.edit_receiveDepartment = res.data.result.receiveDepartment;
                    this.edit_remark = res.data.result.remark;
                })
            },
            confirm_update(){
                axios.post("http://localhost:8080/SMS/store/editInOrOutRecord",{id:this.edit_id,operateNo:"1001",
                    warehousingType:this.edit_in_out_type,warehousingBelongStore:this.edit_belongStore,supplerId:this.edit_supllier,
                    functionUse:this.edit_functionUse,receiveDepartment:this.edit_receiveDepartment,remark:this.edit_remark},{headers: {'token': this.token}}).then(res =>{
                        console.log(res)
                        if(res.data.success == true){
                            $('.modal').map(function () {
                                if (!$(this).is(":hidden")){
                                    $(this).modal('hide');
                                }
                		    });
                            toastr.success("更新出入库记录成功！");
                            this.queryInOurOutRecord();
                        }else{
                            toastr.error(res.data.errorMsg);
                        }
                    })
            },
            change_edit_in_out_type(event){
                this.edit_in_out_type = event.target.value;
            },
            change_edit_belongStore(event){
                this.edit_belongStore = event.target.value;
            },
            change_edit_supllier(event){
                this.edit_supllier = event.target.value;
                console.log(this.edit_supllier);
            },
            change_edit_receiveDepartment(event){
                this.edit_receiveDepartment = event.target.value;
                console.log(this.edit_receiveDepartment)
            },
            row_mingxi(inOutNumber){   //出入库记录明细
                // toastr.error(inOutNumber)
                axios.post("http://localhost:8080/SMS/store/singleStoreInOrOutList",{operateNo:"1001",inOutNumber:inOutNumber},{headers: {'token': this.token}}).then(res =>{
                    console.log("recored_result:", res);
                    this.recored_result = res.data.result
                })
            },
            row_delete(id){  //删除行
                this.delete_in_out_record_id = id;
                console.log(this.delete_in_out_record_id);
            },
            delete_in_out_ofconfirmModal(){     // 删除模态框确认删除该行出入库记录
                axios.post("http://localhost:8080/SMS/store/delInOrOutRecord",{operateNo:"1001", id:this.delete_in_out_record_id, traceLogId:"1001"},{headers: {'token': this.token}}).then(res =>{
                    console.log(res);
                    if (res.data.success == true) {
                        $('.modal').map(function () {
                            if (!$(this).is(":hidden")){
                                $(this).modal('hide');
                            }
                		});
                        toastr.success("删除记录成功！");
                        this.queryInOurOutRecord();
                    } else {
                        toastr.error(res.data.errorMsg);
                    }
                })
            },
            changebelongStore(event){    //添加模态框中的所属仓库
                this.belongStroe = event.target.value;
                console.log(this.belongStroe);
            },
            change_in_out_modal(event){     // 切换供应商和领料部门显示
                this.in_or_out_modal = event.target.value;
                if (this.in_or_out_modal == "IN") {
                    this.isShowSupplier = true
                    this.isShowlingliaobumen = false
                }else if (this.in_or_out_modal == "OUT") {
                    this.isShowSupplier = false
                    this.isShowlingliaobumen = true
                } else {
                    this.isShowSupplier = false
                    this.isShowlingliaobumen = false
                }
                console.log(this.in_or_out_modal)
            },
            add_in_out_record_modal(){      //添加出入库记录
                axios.post("http://localhost:8080/SMS/store/addInOrOutRecord",{functionUse:this.yongtu_addmodal,
                 operateNo:"1001",warehousingBelongStore:this.belongStroe,supplerId:this.supplierSelected,warehousingType:this.in_or_out_modal, 
                 receiveDepartment:this.lingliaobumen_addModal,remark:this.remark_addModal},{headers: {'token': this.token}}).then(res =>{
                     console.log(res);
                     if(res.data.success == true){
                        toastr.success("成功添加记录："+res.data.result.inOutNumber);
                        $('.modal').map(function () {
                            if (!$(this).is(":hidden")){
                                $(this).modal('hide');
                            }
                		});
                        this.queryInOurOutRecord();
                     }else{
                        toastr.error(errorMsg);
                     }
                 })
            },
            change_supplier(event){     //改变供应商事件
                this.supplierSelected = event.target.value
                console.log(this.supplierSelected);
            },
            change_lingliaobumen(event){    //领料部门下拉选择
                this.lingliaobumen_addModal = event.target.value
            },
            // 分页查询
            searchPrevious(){
                if (this.pageIndex > 1) {
                    this.pageIndex -= 1;
                    this.queryInOurOutRecord()
                }
            },
            searchNext(){
                if (this.pageIndex < this.page_data.pages) {
                    this.pageIndex += 1;
                    this.queryInOurOutRecord()
                }
            },
            searchPageIndex(page){
                if(this.pageIndex != page){
					this.pageIndex = page;
					this.queryInOurOutRecord()
				}
            },
        },
        created () {
            this.token = parent.window.document.getElementById("myiframe").getAttribute("value");
            this.getStoreEnum();
            this.queryInOurOutRecord();
        }
    });
</script>

</body>
</html>